function [B,J] = EleBJacob(pointCoor,eleNodeCoor,typeEle)
% An ODE-driven Level-Set Density Method for Topology Optimization of Shell Structures
% Zuyu Li, Email:lizuyu0091@163.com; Yang Liu, Email:285548029@qq.com
switch typeEle
    case 1
        %DKQ element
        ksi = pointCoor(1);
        eta = pointCoor(2);
        pN = [(2*ksi+eta)*(1-eta)/4,(2*ksi-eta)*(1-eta)/4,(2*ksi+eta)*(1+eta)/4,(2*ksi-eta)*(1+eta)/4,...
            -ksi*(1-eta),(1-eta^2)/2,-ksi*(1+eta),-(1-eta^2)/2;
            (2*eta+ksi)*(1-ksi)/4,(2*eta-ksi)*(1+ksi)/4,(2*eta+ksi)*(1+ksi)/4,(2*eta-ksi)*(1-ksi)/4,...
            -(1-ksi^2)/2,-eta*(1+ksi),(1-ksi^2)/2,-eta*(1-ksi)];
        J = pN*[eleNodeCoor;(eleNodeCoor([1,2,3,4],:)+eleNodeCoor([2,3,4,1],:))/2];
        pNChild = J\pN;
        Lx = eleNodeCoor(:,1)-eleNodeCoor([2,3,4,1],1);
        Ly = eleNodeCoor(:,2)-eleNodeCoor([2,3,4,1],2);
        L2 =Lx.^2+Ly.^2;
        a = -Lx./L2;
        b = 3/4*Lx.*Ly./L2;
        c = (Lx.^2/4-Ly.^2/2)./L2;
        d = -Ly./L2;
        e = (Ly.^2/4-Lx.^2/2)./L2;
        pHxpX = [3/2*(a(1)*pNChild(1,5)-a(4)*pNChild(1,8)),b(1)*pNChild(1,5)+b(4)*pNChild(1,8),...
            pNChild(1,1)-c(1)*pNChild(1,5)-c(4)*pNChild(1,8),3/2*(a(2)*pNChild(1,6)-a(1)*pNChild(1,5)),...
            b(2)*pNChild(1,6)+b(1)*pNChild(1,5),pNChild(1,2)-c(2)*pNChild(1,6)-c(1)*pNChild(1,5),...
            3/2*(a(3)*pNChild(1,7)-a(2)*pNChild(1,6)),b(3)*pNChild(1,7)+b(2)*pNChild(1,6),...
            pNChild(1,3)-c(3)*pNChild(1,7)-c(2)*pNChild(1,6),3/2*(a(4)*pNChild(1,8)-a(3)*pNChild(1,7)),...
            b(4)*pNChild(1,8)+b(3)*pNChild(1,7),pNChild(1,4)-c(4)*pNChild(1,8)-c(3)*pNChild(1,7)];
        pHypY = [3/2*(d(1)*pNChild(2,5)-d(4)*pNChild(2,8)),-pNChild(2,1)+e(1)*pNChild(2,5)+e(4)*pNChild(2,8),...
            -b(1)*pNChild(2,5)-b(4)*pNChild(2,8),3/2*(d(2)*pNChild(2,6)-d(1)*pNChild(2,5)),...
            -pNChild(2,2)+e(2)*pNChild(2,6)+e(1)*pNChild(2,5),-b(2)*pNChild(2,6)-b(1)*pNChild(2,5),...
            3/2*(d(3)*pNChild(2,7)-d(2)*pNChild(2,6)),-pNChild(2,3)+e(3)*pNChild(2,7)+e(2)*pNChild(2,6),...
            -b(3)*pNChild(2,7)-b(2)*pNChild(2,6),3/2*(d(4)*pNChild(2,8)-d(3)*pNChild(2,7)),...
            -pNChild(2,4)+e(4)*pNChild(2,8)+e(3)*pNChild(2,7),-b(4)*pNChild(2,8)-b(3)*pNChild(2,7)]; 
        pHxpY = [3/2*(a(1)*pNChild(2,5)-a(4)*pNChild(2,8)),b(1)*pNChild(2,5)+b(4)*pNChild(2,8),...
            pNChild(2,1)-c(1)*pNChild(2,5)-c(4)*pNChild(2,8),3/2*(a(2)*pNChild(2,6)-a(1)*pNChild(2,5)),...
            b(2)*pNChild(2,6)+b(1)*pNChild(2,5),pNChild(2,2)-c(2)*pNChild(2,6)-c(1)*pNChild(2,5),...
            3/2*(a(3)*pNChild(2,7)-a(2)*pNChild(2,6)),b(3)*pNChild(2,7)+b(2)*pNChild(2,6),...
            pNChild(2,3)-c(3)*pNChild(2,7)-c(2)*pNChild(2,6),3/2*(a(4)*pNChild(2,8)-a(3)*pNChild(2,7)),...
            b(4)*pNChild(2,8)+b(3)*pNChild(2,7),pNChild(2,4)-c(4)*pNChild(2,8)-c(3)*pNChild(2,7)];
        pHypX = [3/2*(d(1)*pNChild(1,5)-d(4)*pNChild(1,8)),-pNChild(1,1)+e(1)*pNChild(1,5)+e(4)*pNChild(1,8),...
            -b(1)*pNChild(1,5)-b(4)*pNChild(1,8),3/2*(d(2)*pNChild(1,6)-d(1)*pNChild(1,5)),...
            -pNChild(1,2)+e(2)*pNChild(1,6)+e(1)*pNChild(1,5),-b(2)*pNChild(1,6)-b(1)*pNChild(1,5),...
            3/2*(d(3)*pNChild(1,7)-d(2)*pNChild(1,6)),-pNChild(1,3)+e(3)*pNChild(1,7)+e(2)*pNChild(1,6),...
            -b(3)*pNChild(1,7)-b(2)*pNChild(1,6),3/2*(d(4)*pNChild(1,8)-d(3)*pNChild(1,7)),...
            -pNChild(1,4)+e(4)*pNChild(1,8)+e(3)*pNChild(1,7),-b(4)*pNChild(1,8)-b(3)*pNChild(1,7)];
        B = [pHxpX;pHypY;pHxpY+pHypX];
    case 2
        %Q4 with drilling dof
        ksi = pointCoor(1);
        eta = pointCoor(2);
        pN = [-(1-eta)/4,(1-eta)/4,(1+eta)/4,-(1+eta)/4,-ksi*(1-eta)/8,(1-eta^2)/16,-ksi*(1+eta)/8,-(1-eta^2)/16;
            -(1-ksi)/4,-(1+ksi)/4,(1+ksi)/4,(1-ksi)/4,-(1-ksi^2)/16,-eta*(1+ksi)/8,(1-ksi^2)/16,-eta*(1-ksi)/8];
        J =  pN(:,1:4)*eleNodeCoor;
        pNChild = J\pN;
        Lx = eleNodeCoor(:,1)-eleNodeCoor([2,3,4,1],1);
        Ly = eleNodeCoor(:,2)-eleNodeCoor([2,3,4,1],2);
        B = zeros(3,12);
        B(1,1:3:10) = pNChild(1,1:4);
        B(2,2:3:11) = pNChild(2,1:4);
        B(3,1:3:10) = pNChild(2,1:4);
        B(3,2:3:11) = pNChild(1,1:4);
        B(1,3:3:12) = [-Ly(4)*pNChild(1,8)+Ly(1)*pNChild(1,5),-Ly(1)*pNChild(1,5)+Ly(2)*pNChild(1,6),...
            -Ly(2)*pNChild(1,6)+Ly(3)*pNChild(1,7),-Ly(3)*pNChild(1,7)+Ly(4)*pNChild(1,8)];
        B(2,3:3:12) = [Lx(4)*pNChild(2,8)-Lx(1)*pNChild(2,5),Lx(1)*pNChild(2,5)-Lx(2)*pNChild(2,6),...
            Lx(2)*pNChild(2,6)-Lx(3)*pNChild(2,7),Lx(3)*pNChild(2,7)-Lx(4)*pNChild(2,8)];
        B(3,3:3:12) = [-Ly(4)*pNChild(2,8)+Ly(1)*pNChild(2,5),-Ly(1)*pNChild(2,5)+Ly(2)*pNChild(2,6),...
            -Ly(2)*pNChild(2,6)+Ly(3)*pNChild(2,7),-Ly(3)*pNChild(2,7)+Ly(4)*pNChild(2,8)];
        B(3,3:3:12) = B(3,3:3:12)+[Lx(4)*pNChild(1,8)-Lx(1)*pNChild(1,5),Lx(1)*pNChild(1,5)-Lx(2)*pNChild(1,6),...
            Lx(2)*pNChild(1,6)-Lx(3)*pNChild(1,7),Lx(3)*pNChild(1,7)-Lx(4)*pNChild(1,8)];
end
end